<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>詳細設計書 - 学生用タブレット処理フロー</title>
    <style>
        body { font-family: 'Meiryo', sans-serif; background-color: #f0f2f5; padding: 20px; line-height: 1.4; }
        .container { max-width: 850px; margin: auto; background: white; padding: 40px; border-radius: 12px; shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 15px; margin-bottom: 30px; }
        
        .flow-container { display: flex; flex-direction: column; align-items: center; }
        
        /* 基本の箱 */
        .node { width: 320px; padding: 12px; margin: 10px 0; text-align: center; border: 2px solid #333; position: relative; font-weight: bold; background: #fff; }
        
        /* 形状別 */
        .start-end { border-radius: 30px; background: #34495e; color: white; }
        .process { background: #fff; }
        .diamond { 
            width: 140px; height: 140px; border: 2px solid #333; transform: rotate(45deg); 
            margin: 30px 0; display: flex; align-items: center; justify-content: center; background: #fff;
        }
        .diamond-text { transform: rotate(-45deg); font-size: 13px; line-height: 1.2; }
        
        /* 矢印 */
        .arrow { font-size: 24px; color: #333; margin: -5px 0; }
        
        /* 色付け */
        .bg-blue { background-color: #e8f4fd; }
        .bg-green { background-color: #eafaf1; border-color: #27ae60; }
        .bg-red { background-color: #fdedec; border-color: #e74c3c; }

        /* 特殊ラベル */
        .label-yes { margin-top: -20px; margin-bottom: 5px; color: #27ae60; font-weight: bold; }
        .label-no { margin-left: 200px; margin-top: -100px; color: #e74c3c; font-weight: bold; }
        
        .loop-line {
            width: 100px; height: 2px; background: #e74c3c; position: absolute; right: -100px; top: 50%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>8-1. フローチャート（学生用タブレットアプリ）</h1>
        
        <div class="flow-container">
            <div class="node start-end">開始（アプリ起動）</div>
            <div class="arrow">↓</div>
            
            <div class="node process bg-blue">カメラ権限の確認・取得</div>
            <div class="arrow">↓</div>
            
            <div class="node node-anchor bg-green" style="border-style: double; border-width: 4px;">QRスキャン待機状態 (startScanning)</div>
            <div class="arrow">↓</div>
            
            <div class="node process">QRコードを検出</div>
            <div class="arrow">↓</div>
            
            <div class="node bg-red">スキャンを一時停止 (barcodeView.pause)</div>
            <div class="arrow">↓</div>

            <div class="diamond"><div class="diamond-text">データに<br>room_idが含まれるか</div></div>
            <div class="label-no">No (不正なQR)</div>
            <div class="node bg-red" style="margin-top: -20px;">エラー表示：教室QRではありません</div>
            <div class="arrow">↓</div>
            <div class="node bg-blue">3秒待機 (resumeScanWithDelay)</div>
            <div style="color: #e74c3c; font-size: 12px; margin-bottom: 20px;">↑ スキャン再開へ戻る ↑</div>

            <div class="label-yes">Yes (正常)</div>
            <div class="node process">roomIdのパース・教室名変換</div>
            <div class="arrow">↓</div>
            
            <div class="node process">端末IPアドレス取得 (user_id)</div>
            <div class="arrow">↓</div>
            
            <div class="node process">AttendanceLogのJSON化</div>
            <div class="arrow">↓</div>
            
            <div class="node process bg-blue">サーバへPOST送信 (10.100.56.163)</div>
            <div class="arrow">↓</div>

            <div class="diamond"><div class="diamond-text">HTTP通信成功？</div></div>
            
            <div class="label-no">No (Failure)</div>
            <div class="node bg-red" style="margin-top: -20px;">トースト表示：「送信失敗」</div>
            <div class="arrow">↓</div>
            <div class="node bg-blue">スキャン再開処理へ</div>

            <div class="label-yes">Yes (Response)</div>
            <div class="node bg-green">トースト表示：「出席を記録しました」</div>
            <div class="arrow">↓</div>
            
            <div class="node bg-blue">3秒待機</div>
            <div class="arrow">↓</div>
            
            <div class="node process">ブラウザでWebページを表示</div>
            <div class="arrow">↓</div>
            
            <div class="node start-end">終了</div>
        </div>
    </div>
</body>
</html>